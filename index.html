<!doctype html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ“® WebApp sinh prompt chá»§ nhiá»‡m â€“ Báº£n lung linh</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Sinh nhanh cÃ¡c máº«u tin nháº¯n chá»§ nhiá»‡m vá»›i giao diá»‡n lung linh: gradient, glassmorphism, ripple, dark mode.">
  <style>
    :root{
      --brandA: #6d28d9; /* indigo-700 */
      --brandB: #22c55e; /* emerald-500 */
      --brandC: #06b6d4; /* cyan-500 */
      --card: rgba(255,255,255,.78);
      --glass: rgba(255,255,255,.55);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --card: rgba(17,24,39,.72);
        --glass: rgba(17,24,39,.55);
      }
    }
    /* Animated gradient header */
    .gradbar {
      background: linear-gradient(110deg, var(--brandA), var(--brandB), var(--brandC));
      background-size: 200% 200%;
      animation: gradientShift 12s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Glass card */
    .glass {
      background: var(--card);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow:
        0 10px 30px rgba(2,6,23,.08),
        inset 0 1px 0 rgba(255,255,255,.4);
      border-radius: 16px;
    }
    /* Pretty focus */
    .nice-focus:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,.35);
      border-color: rgb(99,102,241);
    }
    /* Buttons */
    .btn {
      position: relative; overflow: hidden;
      transition: transform .08s ease, box-shadow .2s ease, filter .25s ease;
      border-radius: 12px; font-weight: 600;
    }
    .btn:active { transform: translateY(1px) scale(.99); }
    .btn-primary {
      background: linear-gradient(120deg, #4f46e5, #06b6d4);
      color: white;
      box-shadow: 0 10px 20px rgba(79,70,229,.25);
    }
    .btn-primary:hover { filter: brightness(1.06); }
    .btn-ghost {
      background: linear-gradient(120deg, #0ea5e9, #22c55e);
      color: white;
    }
    .btn-dark {
      background: #0f172a; color: #fff;
    }
    .btn-outline {
      background: transparent; border: 1px solid rgba(15,23,42,.2);
    }
    /* Ripple */
    .btn .ripple {
      position: absolute; border-radius: 50%; transform: scale(0);
      background: rgba(255,255,255,.5); animation: ripple .6s linear;
      pointer-events: none;
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }
    /* Glow ring title */
    .glow {
      text-shadow: 0 1px 0 rgba(255,255,255,.6), 0 8px 30px rgba(79,70,229,.35);
    }
    /* Output textarea styling */
    .paper {
      background:
        radial-gradient(1200px 400px at 0 -10%, rgba(79,70,229,.05), transparent),
        radial-gradient(800px 400px at 100% 110%, rgba(14,165,233,.06), transparent),
        #ffffff;
      border: 1px solid rgba(2,6,23,.08);
      border-radius: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 10px 24px rgba(2,6,23,.08);
    }
    .meter{
      height: 6px; border-radius: 9999px; background: rgba(2,6,23,.08);
      position: relative; overflow: hidden;
    }
    .meter>span{
      position:absolute; inset:0;
      background: linear-gradient(90deg,#22c55e,#06b6d4,#4f46e5);
      background-size: 200% 100%;
      animation: gradientShift 8s ease infinite;
      border-radius: 9999px;
      transform-origin:left center;
      transform: scaleX(0);
    }
    /* Tag pill */
    .pill {
      background: rgba(99,102,241,.1);
      color: #4338ca;
      border: 1px solid rgba(79,70,229,.25);
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 relative selection:bg-indigo-100 selection:text-indigo-900">
  <!-- Header -->
  <div class="gradbar py-6 shadow-md">
    <header class="max-w-6xl mx-auto px-4 flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-black text-white glow">ğŸ“® WebApp sinh prompt chá»§ nhiá»‡m</h1>
      <div class="hidden md:flex items-center gap-2 text-white/90">
        <span class="pill px-3 py-1 rounded-full text-xs backdrop-blur">Lung linh v2</span>
        <span class="pill px-3 py-1 rounded-full text-xs backdrop-blur">Made for GVCN</span>
      </div>
    </header>
  </div>

  <!-- Container -->
  <main class="max-w-6xl mx-auto px-4 -mt-6 md:-mt-8 pb-10 grid md:grid-cols-5 gap-4">
    <!-- Left column -->
    <section class="md:col-span-2 space-y-4">
      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg flex items-center gap-2">1) Loáº¡i tin nháº¯n
          <span class="text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700">Chá»n nhÃ³m</span>
        </h2>
        <label class="block text-sm">NhÃ³m</label>
        <select id="group" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
          <option value="violation">Xá»­ lÃ½ vi pháº¡m ná»™i quy</option>
          <option value="encourage">Äá»™ng viÃªn â€“ khÃ­ch lá»‡ (chung lá»›p)</option>
          <option value="praise">TuyÃªn dÆ°Æ¡ng cÃ¡ nhÃ¢n/nhÃ³m</option>
          <option value="softremind">Nháº¯c nhá»Ÿ nháº¹ nhÃ ng</option>
          <option value="inspire">Truyá»n cáº£m há»©ng â€“ Ä‘á»‹nh hÆ°á»›ng</option>
          <option value="parents">Gá»­i phá»¥ huynh (tá»•ng káº¿t, gáº¯n káº¿t)</option>
        </select>

        <div id="violationControls" class="space-y-2">
          <label class="block text-sm">Má»©c Ä‘á»™ (láº§n)</label>
          <select id="level" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
            <option value="1">Láº§n 1 (nháº¹ nhÃ ng)</option>
            <option value="2">Láº§n 2 (nghiÃªm tÃºc hÆ¡n)</option>
            <option value="3">Láº§n 3 (rÃµ rÃ ng, quyáº¿t liá»‡t)</option>
          </select>

          <label class="block text-sm">Loáº¡i vi pháº¡m</label>
          <select id="viotype" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
            <option value="Ä‘i há»c trá»…">Äi há»c trá»…</option>
            <option value="Ä‘á»“ng phá»¥c">KhÃ´ng máº·c Ä‘Ãºng Ä‘á»“ng phá»¥c</option>
            <option value="Ä‘iá»‡n thoáº¡i">Sá»­ dá»¥ng Ä‘iá»‡n thoáº¡i sai quy Ä‘á»‹nh</option>
            <option value="bÃ i táº­p">KhÃ´ng hoÃ n thÃ nh bÃ i táº­p</option>
            <option value="lá»… phÃ©p">Thiáº¿u lá»… phÃ©p</option>
            <option value="khÃ¡c">KhÃ¡c (tá»± Ä‘iá»n)</option>
          </select>
          <input id="viotypeCustom" placeholder="MÃ´ táº£ vi pháº¡m khÃ¡c..." class="w-full border rounded-lg p-2 nice-focus hidden bg-white/70" />
        </div>

        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm">Gá»­i cho</label>
            <select id="audience" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
              <option value="hs">Há»c sinh</option>
              <option value="ph">Phá»¥ huynh</option>
            </select>
          </div>
          <div>
            <label class="block text-sm">Giá»ng Ä‘iá»‡u</label>
            <select id="tone" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
              <option value="máº·c Ä‘á»‹nh">Máº·c Ä‘á»‹nh</option>
              <option value="áº¥m Ã¡p">áº¤m Ã¡p</option>
              <option value="nghiÃªm tÃºc">NghiÃªm tÃºc</option>
              <option value="truyá»n cáº£m há»©ng">Truyá»n cáº£m há»©ng</option>
            </select>
          </div>
        </div>
      </div>

      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg">2) ThÃ´ng tin chÃ¨n tá»± Ä‘á»™ng</h2>
        <div class="grid grid-cols-2 gap-2">
          <input id="student" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="TÃªn há»c sinh (vd: ThÃ¹y TrÃ¢m)" />
          <input id="class" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="Lá»›p (vd: 10A8)" />
          <input id="date" type="date" class="border rounded-lg p-2 nice-focus bg-white/70" />
          <input id="groupname" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="TÃªn nhÃ³m (vd: NhÃ³m 2)" />
          <input id="achievement" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="ThÃ nh tÃ­ch (vd: phÃ¡t biá»ƒu tÃ­ch cá»±c)" />
          <input id="teacher" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="TÃªn tháº§y/cÃ´ (vd: Tháº§y Lá»±c)" />
        </div>
        <div class="flex flex-wrap items-center gap-3 pt-1">
          <label class="flex items-center gap-2"><input id="useEmoji" type="checkbox" class="scale-110" checked> <span>DÃ¹ng emoji</span></label>
          <label class="flex items-center gap-2"><input id="addHeader" type="checkbox" class="scale-110"> <span>ThÃªm má»Ÿ Ä‘áº§u â€œKÃ­nh gá»­iâ€¦â€</span></label>
        </div>
        <div class="meter mt-2"><span id="progress"></span></div>
      </div>

      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg">3) HÃ nh Ä‘á»™ng</h2>
        <div class="flex flex-wrap gap-2">
          <button id="btnGenerate" class="btn btn-primary px-4 py-2">Sinh ná»™i dung</button>
          <button id="btnCopy" class="btn btn-dark px-4 py-2">Copy</button>
          <button id="btnDownload" class="btn btn-ghost px-4 py-2">Táº£i .txt</button>
          <button id="btnReset" class="btn btn-outline px-3 py-2">LÃ m má»›i</button>
        </div>
        <p class="text-xs text-slate-500 mt-2">Máº¹o: Ä‘iá»n <em>TÃªn HS</em> + <em>Lá»›p</em> + <em>NgÃ y</em> trÆ°á»›c khi sinh Ä‘á»ƒ cÃ¡ nhÃ¢n hoÃ¡.</p>
      </div>

      <div class="glass p-4 md:p-5 space-y-2">
        <h2 class="font-semibold text-lg">4) Preset nhanh</h2>
        <div class="flex flex-wrap gap-2 text-sm">
          <button data-preset="late2hs" class="btn btn-outline px-3 py-1.5">Äi trá»… láº§n 2 â†’ HS</button>
          <button data-preset="late3ph" class="btn btn-outline px-3 py-1.5">Äi trá»… láº§n 3 â†’ PH</button>
          <button data-preset="praise" class="btn btn-outline px-3 py-1.5">TuyÃªn dÆ°Æ¡ng nhÃ³m</button>
          <button data-preset="enc" class="btn btn-outline px-3 py-1.5">Äá»™ng viÃªn lá»›p</button>
        </div>
      </div>
    </section>

    <!-- Right column -->
    <section class="md:col-span-3 space-y-3">
      <div class="glass p-4 md:p-5 h-full">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold text-lg">Ná»™i dung sinh ra</h2>
          <div class="text-xs text-slate-500 flex items-center gap-2">
            <span id="charCount">0 kÃ­ tá»±</span>
            <span class="hidden md:inline">â€¢</span>
            <span class="hidden md:inline">Tá»± Ä‘á»™ng chÃ¨n tÃªn, lá»›p, ngÃ yâ€¦</span>
          </div>
        </div>
        <textarea id="output" class="paper w-full h-[560px] mt-3 font-[Inter] leading-7 border rounded-lg p-4 resize-vertical nice-focus" placeholder="(Ná»™i dung sáº½ hiá»‡n á»Ÿ Ä‘Ã¢y)"></textarea>
      </div>
      <footer class="text-center text-xs text-slate-500 mt-2">Â© 2025 â€“ Báº£n lung linh. Má»i chi tiáº¿t cÃ³ thá»ƒ chá»‰nh trong pháº§n mÃ£.</footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    // Elements
    const groupEl = $("group");
    const levelEl = $("level");
    const viotypeEl = $("viotype");
    const viotypeCustomEl = $("viotypeCustom");
    const audienceEl = $("audience");
    const toneEl = $("tone");
    const studentEl = $("student");
    const classEl = $("class");
    const dateEl = $("date");
    const groupnameEl = $("groupname");
    const achievementEl = $("achievement");
    const teacherEl = $("teacher");
    const useEmojiEl = $("useEmoji");
    const addHeaderEl = $("addHeader");
    const outputEl = $("output");
    const progressEl = $("progress");
    const charCountEl = $("charCount");
    const violationControls = $("violationControls");

    function ripple(e){
      const btn = e.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(btn.clientWidth, btn.clientHeight);
      const radius = diameter / 2;
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - btn.getBoundingClientRect().left - radius}px`;
      circle.style.top = `${e.clientY - btn.getBoundingClientRect().top - radius}px`;
      circle.classList.add("ripple");
      const ripple = btn.getElementsByClassName("ripple")[0];
      if (ripple) ripple.remove();
      btn.appendChild(circle);
    }
    document.querySelectorAll(".btn").forEach(b => b.addEventListener("click", ripple));

    // Toggle custom viotype
    viotypeEl.addEventListener("change", () => {
      viotypeCustomEl.classList.toggle("hidden", viotypeEl.value !== "khÃ¡c");
    });
    // Toggle violation block
    groupEl.addEventListener("change", () => {
      violationControls.classList.toggle("hidden", groupEl.value !== "violation");
    });

    // Templates
    const templates = {
      violation: {
        hs: {
          1: (ctx) => `${ctx.emoji} Tháº§y ghi nháº­n ${ctx.studentTxt} chÄƒm chá»‰, nhÆ°ng hÃ´m nay em ${ctx.viotypeTxt}. Äi Ä‘Ãºng giá» vÃ  cháº¥p hÃ nh ná»™i quy giÃºp em há»c tá»‘t vÃ  tÃ´n trá»ng tháº§y cÃ´, báº¡n bÃ¨. Tháº§y tin láº§n sau em sáº½ chá»§ Ä‘á»™ng hÆ¡n nhÃ©!`,
          2: (ctx) => `${ctx.emoji} Em Ä‘Ã£ ${ctx.viotypeTxt} láº§n thá»© 2 (ngÃ y ${ctx.dateTxt}). Tháº§y mong em nhÃ¬n láº¡i nguyÃªn nhÃ¢n, sáº¯p xáº¿p thá»i gian há»£p lÃ½. Cháº¥p hÃ nh ná»™i quy thá»ƒ hiá»‡n trÃ¡ch nhiá»‡m vÃ  giÃºp em tá»± tin hÆ¡n. Tháº§y tin em sáº½ thay Ä‘á»•i tÃ­ch cá»±c!`,
          3: (ctx) => `${ctx.emoji} ÄÃ¢y lÃ  láº§n thá»© 3 em ${ctx.viotypeTxt}. Tháº§y mong em nghiÃªm tÃºc Ä‘iá»u chá»‰nh ngay â€“ Ä‘Ã¢y lÃ  ká»· luáº­t vÃ  trÃ¡ch nhiá»‡m cá»§a má»™t há»c sinh. Tháº§y tin em cÃ³ báº£n lÄ©nh Ä‘á»ƒ thay Ä‘á»•i vÃ  chá»©ng minh sá»± trÆ°á»Ÿng thÃ nh.`
        },
        ph: {
          1: (ctx) => `KÃ­nh gá»­i quÃ½ phá»¥ huynh, hÃ´m nay em ${ctx.studentTxt} (${ctx.classTxt}) ${ctx.viotypeTxt}. ÄÃ¢y lÃ  láº§n Ä‘áº§u, tháº§y nháº¯c nháº¹ Ä‘á»ƒ em rÃºt kinh nghiá»‡m. Mong gia Ä‘Ã¬nh Ä‘á»™ng viÃªn em giá»¯ ná» náº¿p áº¡.`,
          2: (ctx) => `KÃ­nh gá»­i quÃ½ phá»¥ huynh, Ä‘Ã¢y lÃ  láº§n thá»© 2 em ${ctx.studentTxt} (${ctx.classTxt}) ${ctx.viotypeTxt} (ngÃ y ${ctx.dateTxt}). Mong gia Ä‘Ã¬nh phá»‘i há»£p nháº¯c nhá»Ÿ thÃªm Ä‘á»ƒ em hÃ¬nh thÃ nh thÃ³i quen tá»‘t.`,
          3: (ctx) => `KÃ­nh chÃ o quÃ½ phá»¥ huynh, em ${ctx.studentTxt} (${ctx.classTxt}) Ä‘Ã£ ${ctx.viotypeTxt} láº§n thá»© 3. Äá» nghá»‹ gia Ä‘Ã¬nh phá»‘i há»£p cháº·t cháº½ Ä‘á»ƒ em Ä‘iá»u chá»‰nh ká»‹p thá»i, trÃ¡nh áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c há»c vÃ  ná» náº¿p lá»›p.`
        }
      },
      encourage: {
        all: (ctx) => `${ctx.emoji} HÃ´m nay tháº§y ráº¥t vui vÃ¬ lá»›p ${ctx.classTxt} há»c táº­p nghiÃªm tÃºc vÃ  Ä‘oÃ n káº¿t. Mong cÃ¡c em giá»¯ tinh tháº§n nÃ y cho cáº£ tuáº§n nhÃ©!`
      },
      praise: {
        group: (ctx) => `${ctx.emoji} ChÃºc má»«ng ${ctx.groupnameTxt} Ä‘Ã£ lÃ m viá»‡c tÃ­ch cá»±c trong tiáº¿t há»c hÃ´m nay. ÄÃ¢y lÃ  táº¥m gÆ°Æ¡ng Ä‘á»ƒ cáº£ lá»›p noi theo!`,
        person: (ctx) => `${ctx.emoji} Báº¡n ${ctx.studentTxt} Ä‘Ã£ tiáº¿n bá»™ rÃµ rá»‡t trong ${ctx.achievementTxt}. Mong cÃ¡c báº¡n khÃ¡c há»c táº­p tinh tháº§n chá»§ Ä‘á»™ng nÃ y.`
      },
      softremind: {
        hw: (ctx) => `${ctx.emoji} Má»™t sá»‘ báº¡n chÆ°a hoÃ n thÃ nh bÃ i táº­p. CÃ¡c em sáº¯p xáº¿p láº¡i thá»i gian Ä‘á»ƒ theo ká»‹p bÃ i nhÃ©. Tháº§y tin cÃ¡c em lÃ m Ä‘Æ°á»£c.`,
        gear: (ctx) => `${ctx.emoji} Má»™t sá»‘ báº¡n quÃªn mang sÃ¡ch vá»Ÿ, láº§n sau nhá»› chuáº©n bá»‹ Ä‘áº§y Ä‘á»§ nhÃ©. ThÃ³i quen nhá» giÃºp em há»c tá»‘t hÆ¡n.`
      },
      inspire: {
        a: (ctx) => `${ctx.emoji} Äi há»c khÃ´ng chá»‰ Ä‘á»ƒ láº¥y Ä‘iá»ƒm, mÃ  lÃ  hÃ nh trÃ¬nh rÃ¨n luyá»‡n sá»± kiÃªn nháº«n vÃ  trÃ¡ch nhiá»‡m. HÃ£y cá»‘ gáº¯ng tá»«ng ngÃ y, tháº§y luÃ´n Ä‘á»“ng hÃ nh cÃ¹ng cÃ¡c em.`,
        b: (ctx) => `${ctx.emoji} Má»—i khÃ³ khÄƒn lÃ  má»™t cÆ¡ há»™i Ä‘á»ƒ trÆ°á»Ÿng thÃ nh. Tháº§y tin lá»›p mÃ¬nh Ä‘á»§ báº£n lÄ©nh Ä‘á»ƒ vÆ°á»£t qua má»i thá»­ thÃ¡ch.`
      },
      parents: {
        a: (ctx) => `KÃ­nh gá»­i quÃ½ phá»¥ huynh, trong tuáº§n qua lá»›p ${ctx.classTxt} Ä‘Ã£ cÃ³ nhiá»u tiáº¿n bá»™ vá» ná» náº¿p há»c táº­p. ChÃ¢n thÃ nh cáº£m Æ¡n gia Ä‘Ã¬nh Ä‘Ã£ luÃ´n Ä‘á»“ng hÃ nh.`,
        b: (ctx) => `NhÃ  trÆ°á»ng vÃ  gia Ä‘Ã¬nh lÃ  hai cÃ¡nh tay giÃºp cÃ¡c em phÃ¡t triá»ƒn toÃ n diá»‡n. Mong quÃ½ phá»¥ huynh tiáº¿p tá»¥c phá»‘i há»£p cháº·t cháº½ Ä‘á»ƒ nháº¯c nhá»Ÿ con em giá»¯ ná» náº¿p vÃ  tinh tháº§n há»c táº­p.`
      }
    };

    function buildContext() {
      const emojiMap = {
        "máº·c Ä‘á»‹nh": "âœ…",
        "áº¥m Ã¡p": "ğŸ’›",
        "nghiÃªm tÃºc": "âš ï¸",
        "truyá»n cáº£m há»©ng": "ğŸš€"
      };
      const emoji = $("useEmoji").checked ? (emojiMap[$("tone").value] || "âœ…") : "";
      const studentTxt = studentEl.value || "em â€¦";
      const classTxt = classEl.value || "lá»›p â€¦";
      const dateTxt = dateEl.value || "â€¦/â€¦/â€¦";
      let viotype = viotypeEl.value === "khÃ¡c" ? (viotypeCustomEl.value || "vi pháº¡m ná»™i quy") : viotypeEl.value;
      const groupnameTxt = groupnameEl.value || "nhÃ³m â€¦";
      const achievementTxt = achievementEl.value || "â€¦";
      const teacherTxt = teacherEl.value || "Tháº§y VÅ© Tiáº¿n Lá»±c 0969068849";
      return { emoji, studentTxt, classTxt, dateTxt, viotypeTxt: viotype, groupnameTxt, achievementTxt, teacherTxt };
    }

    function generate() {
      const ctx = buildContext();
      const group = groupEl.value;
      const audience = audienceEl.value;
      let text = "";

      if (group === "violation") {
        const lv = levelEl.value;
        text = templates.violation[audience][lv](ctx);
      } else if (group === "encourage") {
        text = templates.encourage.all(ctx);
      } else if (group === "praise") {
        text = (groupnameEl.value ? templates.praise.group(ctx) : templates.praise.person(ctx));
      } else if (group === "softremind") {
        text = (achievementEl.value ? templates.softremind.hw(ctx) : templates.softremind.gear(ctx));
      } else if (group === "inspire") {
        text = (toneEl.value === "truyá»n cáº£m há»©ng" ? templates.inspire.b(ctx) : templates.inspire.a(ctx));
      } else if (group === "parents") {
        text = (achievementEl.value ? templates.parents.b(ctx) : templates.parents.a(ctx));
      }

      if (addHeaderEl.checked) {
        if (audience === "ph") text = `KÃ­nh gá»­i quÃ½ phá»¥ huynh,\n${text.replace(/^KÃ­nh.*?phá»¥ huynh,?\s*/i, "")}`;
        else text = `ChÃ o em,\n${text}`;
      }
      if (ctx.teacherTxt && ctx.teacherTxt.trim() !== "") text += `\n\n${ctx.teacherTxt}`;

      outputEl.value = text;
      updateStats();
    }

    function updateStats(){
      const len = outputEl.value.length;
      charCountEl.textContent = `${len} kÃ­ tá»±`;
      const fill = Math.min(1, len / 400);
      progressEl.style.transform = `scaleX(${fill})`;
    }

    function copyToClipboard() {
      outputEl.select();
      document.execCommand("copy");
      const btn = document.getElementById("btnCopy");
      const old = btn.textContent;
      btn.textContent = "ÄÃ£ copy âœ…";
      setTimeout(() => (btn.textContent = old), 1200);
    }

    function downloadTxt() {
      const blob = new Blob([outputEl.value || ""], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "tin-nhan-chu-nhiem.txt";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    function resetAll() {
      groupEl.value = "violation";
      levelEl.value = "1";
      viotypeEl.value = "Ä‘i há»c trá»…";
      viotypeCustomEl.value = "";
      viotypeCustomEl.classList.add("hidden");
      audienceEl.value = "hs";
      toneEl.value = "máº·c Ä‘á»‹nh";
      studentEl.value = "";
      classEl.value = "";
      dateEl.value = "";
      groupnameEl.value = "";
      achievementEl.value = "";
      teacherEl.value = "Tháº§y Lá»±c";
      $("useEmoji").checked = true;
      $("addHeader").checked = false;
      outputEl.value = "";
      violationControls.classList.remove("hidden");
      updateStats();
    }

    // Presets
    document.querySelectorAll("[data-preset]").forEach(btn => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-preset");
        resetAll();
        if (key === "late2hs") {
          groupEl.value = "violation"; levelEl.value = "2"; audienceEl.value = "hs"; viotypeEl.value = "Ä‘i há»c trá»…";
          studentEl.value = "ThÃ¹y TrÃ¢m"; classEl.value = "10A8";
        } else if (key === "late3ph") {
          groupEl.value = "violation"; levelEl.value = "3"; audienceEl.value = "ph"; viotypeEl.value = "Ä‘i há»c trá»…";
          studentEl.value = "â€¦"; classEl.value = "10A8";
        } else if (key === "praise") {
          groupEl.value = "praise"; groupnameEl.value = "NhÃ³m 2"; achievementEl.value = "thuyáº¿t trÃ¬nh xuáº¥t sáº¯c";
        } else if (key === "enc") {
          groupEl.value = "encourage"; classEl.value = "10A8";
        }
        generate();
      });
    });

    $("btnGenerate").addEventListener("click", generate);
    $("btnCopy").addEventListener("click", copyToClipboard);
    $("btnDownload").addEventListener("click", downloadTxt);
    $("btnReset").addEventListener("click", resetAll);
    outputEl.addEventListener("input", updateStats);

    // Init
    resetAll();
  </script>
</body>
</html>
