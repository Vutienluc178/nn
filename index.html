<!doctype html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üìÆ WebApp sinh prompt ch·ªß nhi·ªám ‚Äì B·∫£n lung linh</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Sinh nhanh c√°c m·∫´u tin nh·∫Øn ch·ªß nhi·ªám v·ªõi giao di·ªán lung linh: gradient, glassmorphism, ripple, dark mode.">
  <style>
    :root{
      --brandA: #6d28d9; /* indigo-700 */
      --brandB: #22c55e; /* emerald-500 */
      --brandC: #06b6d4; /* cyan-500 */
      --card: rgba(255,255,255,.78);
      --glass: rgba(255,255,255,.55);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --card: rgba(17,24,39,.72);
        --glass: rgba(17,24,39,.55);
      }
    }
    /* Animated gradient header */
    .gradbar {
      background: linear-gradient(110deg, var(--brandA), var(--brandB), var(--brandC));
      background-size: 200% 200%;
      animation: gradientShift 12s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Glass card */
    .glass {
      background: var(--card);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow:
        0 10px 30px rgba(2,6,23,.08),
        inset 0 1px 0 rgba(255,255,255,.4);
      border-radius: 16px;
    }
    /* Pretty focus */
    .nice-focus:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(99,102,241,.35);
      border-color: rgb(99,102,241);
    }
    /* Buttons */
    .btn {
      position: relative; overflow: hidden;
      transition: transform .08s ease, box-shadow .2s ease, filter .25s ease;
      border-radius: 12px; font-weight: 600;
    }
    .btn:active { transform: translateY(1px) scale(.99); }
    .btn-primary {
      background: linear-gradient(120deg, #4f46e5, #06b6d4);
      color: white;
      box-shadow: 0 10px 20px rgba(79,70,229,.25);
    }
    .btn-primary:hover { filter: brightness(1.06); }
    .btn-ghost {
      background: linear-gradient(120deg, #0ea5e9, #22c55e);
      color: white;
    }
    .btn-dark {
      background: #0f172a; color: #fff;
    }
    .btn-outline {
      background: transparent; border: 1px solid rgba(15,23,42,.2);
    }
    /* Ripple */
    .btn .ripple {
      position: absolute; border-radius: 50%; transform: scale(0);
      background: rgba(255,255,255,.5); animation: ripple .6s linear;
      pointer-events: none;
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }
    /* Glow ring title */
    .glow {
      text-shadow: 0 1px 0 rgba(255,255,255,.6), 0 8px 30px rgba(79,70,229,.35);
    }
    /* Output textarea styling */
    .paper {
      background:
        radial-gradient(1200px 400px at 0 -10%, rgba(79,70,229,.05), transparent),
        radial-gradient(800px 400px at 100% 110%, rgba(14,165,233,.06), transparent),
        #ffffff;
      border: 1px solid rgba(2,6,23,.08);
      border-radius: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 10px 24px rgba(2,6,23,.08);
    }
    .meter{
      height: 6px; border-radius: 9999px; background: rgba(2,6,23,.08);
      position: relative; overflow: hidden;
    }
    .meter>span{
      position:absolute; inset:0;
      background: linear-gradient(90deg,#22c55e,#06b6d4,#4f46e5);
      background-size: 200% 100%;
      animation: gradientShift 8s ease infinite;
      border-radius: 9999px;
      transform-origin:left center;
      transform: scaleX(0);
    }
    /* Tag pill */
    .pill {
      background: rgba(99,102,241,.1);
      color: #4338ca;
      border: 1px solid rgba(79,70,229,.25);
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 relative selection:bg-indigo-100 selection:text-indigo-900">
  <!-- Header -->
  <div class="gradbar py-6 shadow-md">
    <header class="max-w-6xl mx-auto px-4 flex items-center justify-between">
      <h1 class="text-2xl md:text-3xl font-black text-white glow">üìÆ WebApp sinh prompt ch·ªß nhi·ªám</h1>
      <div class="hidden md:flex items-center gap-2 text-white/90">
        <span class="pill px-3 py-1 rounded-full text-xs backdrop-blur">Lung linh v2</span>
        <span class="pill px-3 py-1 rounded-full text-xs backdrop-blur">Made for GVCN</span>
      </div>
    </header>
  </div>

  <!-- Container -->
  <main class="max-w-6xl mx-auto px-4 -mt-6 md:-mt-8 pb-10 grid md:grid-cols-5 gap-4">
    <!-- Left column -->
    <section class="md:col-span-2 space-y-4">
      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg flex items-center gap-2">1) Lo·∫°i tin nh·∫Øn
          <span class="text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700">Ch·ªçn nh√≥m</span>
        </h2>
        <label class="block text-sm">Nh√≥m</label>
        <select id="group" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
          <option value="violation">X·ª≠ l√Ω vi ph·∫°m n·ªôi quy</option>
          <option value="encourage">ƒê·ªông vi√™n ‚Äì kh√≠ch l·ªá (chung l·ªõp)</option>
          <option value="praise">Tuy√™n d∆∞∆°ng c√° nh√¢n/nh√≥m</option>
          <option value="softremind">Nh·∫Øc nh·ªü nh·∫π nh√†ng</option>
          <option value="inspire">Truy·ªÅn c·∫£m h·ª©ng ‚Äì ƒë·ªãnh h∆∞·ªõng</option>
          <option value="parents">G·ª≠i ph·ª• huynh (t·ªïng k·∫øt, g·∫Øn k·∫øt)</option>
        </select>

        <div id="violationControls" class="space-y-2">
          <label class="block text-sm">M·ª©c ƒë·ªô (l·∫ßn)</label>
          <select id="level" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
            <option value="1">L·∫ßn 1 (nh·∫π nh√†ng)</option>
            <option value="2">L·∫ßn 2 (nghi√™m t√∫c h∆°n)</option>
            <option value="3">L·∫ßn 3 (r√µ r√†ng, quy·∫øt li·ªát)</option>
          </select>

          <label class="block text-sm">Lo·∫°i vi ph·∫°m</label>
          <select id="viotype" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
            <option value="ƒëi h·ªçc tr·ªÖ">ƒêi h·ªçc tr·ªÖ</option>
            <option value="ƒë·ªìng ph·ª•c">Kh√¥ng m·∫∑c ƒë√∫ng ƒë·ªìng ph·ª•c</option>
            <option value="ƒëi·ªán tho·∫°i">S·ª≠ d·ª•ng ƒëi·ªán tho·∫°i sai quy ƒë·ªãnh</option>
            <option value="b√†i t·∫≠p">Kh√¥ng ho√†n th√†nh b√†i t·∫≠p</option>
            <option value="l·ªÖ ph√©p">Thi·∫øu l·ªÖ ph√©p</option>
            <option value="kh√°c">Kh√°c (t·ª± ƒëi·ªÅn)</option>
          </select>
          <input id="viotypeCustom" placeholder="M√¥ t·∫£ vi ph·∫°m kh√°c..." class="w-full border rounded-lg p-2 nice-focus hidden bg-white/70" />
        </div>

        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm">G·ª≠i cho</label>
            <select id="audience" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
              <option value="hs">H·ªçc sinh</option>
              <option value="ph">Ph·ª• huynh</option>
            </select>
          </div>
          <div>
            <label class="block text-sm">Gi·ªçng ƒëi·ªáu</label>
            <select id="tone" class="w-full border rounded-lg p-2 nice-focus bg-white/70">
              <option value="m·∫∑c ƒë·ªãnh">M·∫∑c ƒë·ªãnh</option>
              <option value="·∫•m √°p">·∫§m √°p</option>
              <option value="nghi√™m t√∫c">Nghi√™m t√∫c</option>
              <option value="truy·ªÅn c·∫£m h·ª©ng">Truy·ªÅn c·∫£m h·ª©ng</option>
            </select>
          </div>
        </div>
      </div>

      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg">2) Th√¥ng tin ch√®n t·ª± ƒë·ªông</h2>
        <div class="grid grid-cols-2 gap-2">
          <input id="student" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="T√™n h·ªçc sinh (vd: Th√πy Tr√¢m)" />
          <input id="class" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="L·ªõp (vd: 10A8)" />
          <input id="date" type="date" class="border rounded-lg p-2 nice-focus bg-white/70" />
          <input id="groupname" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="T√™n nh√≥m (vd: Nh√≥m 2)" />
          <input id="achievement" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="Th√†nh t√≠ch (vd: ph√°t bi·ªÉu t√≠ch c·ª±c)" />
          <input id="teacher" class="border rounded-lg p-2 nice-focus bg-white/70" placeholder="T√™n th·∫ßy/c√¥ (vd: Th·∫ßy L·ª±c)" />
        </div>
        <div class="flex flex-wrap items-center gap-3 pt-1">
          <label class="flex items-center gap-2"><input id="useEmoji" type="checkbox" class="scale-110" checked> <span>D√πng emoji</span></label>
          <label class="flex items-center gap-2"><input id="addHeader" type="checkbox" class="scale-110"> <span>Th√™m m·ªü ƒë·∫ßu ‚ÄúK√≠nh g·ª≠i‚Ä¶‚Äù</span></label>
        </div>
        <div class="meter mt-2"><span id="progress"></span></div>
      </div>

      <div class="glass p-4 md:p-5 space-y-3">
        <h2 class="font-semibold text-lg">3) H√†nh ƒë·ªông</h2>
        <div class="flex flex-wrap gap-2">
          <button id="btnGenerate" class="btn btn-primary px-4 py-2">Sinh n·ªôi dung</button>
          <button id="btnCopy" class="btn btn-dark px-4 py-2">Copy</button>
          <button id="btnDownload" class="btn btn-ghost px-4 py-2">T·∫£i .txt</button>
          <button id="btnReset" class="btn btn-outline px-3 py-2">L√†m m·ªõi</button>
        </div>
        <p class="text-xs text-slate-500 mt-2">M·∫πo: ƒëi·ªÅn <em>T√™n HS</em> + <em>L·ªõp</em> + <em>Ng√†y</em> tr∆∞·ªõc khi sinh ƒë·ªÉ c√° nh√¢n ho√°.</p>
      </div>

      <div class="glass p-4 md:p-5 space-y-2">
        <h2 class="font-semibold text-lg">4) Preset nhanh</h2>
        <div class="flex flex-wrap gap-2 text-sm">
          <button data-preset="late2hs" class="btn btn-outline px-3 py-1.5">ƒêi tr·ªÖ l·∫ßn 2 ‚Üí HS</button>
          <button data-preset="late3ph" class="btn btn-outline px-3 py-1.5">ƒêi tr·ªÖ l·∫ßn 3 ‚Üí PH</button>
          <button data-preset="praise" class="btn btn-outline px-3 py-1.5">Tuy√™n d∆∞∆°ng nh√≥m</button>
          <button data-preset="enc" class="btn btn-outline px-3 py-1.5">ƒê·ªông vi√™n l·ªõp</button>
        </div>
      </div>
    </section>

    <!-- Right column -->
    <section class="md:col-span-3 space-y-3">
      <div class="glass p-4 md:p-5 h-full">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold text-lg">N·ªôi dung sinh ra</h2>
          <div class="text-xs text-slate-500 flex items-center gap-2">
            <span id="charCount">0 k√≠ t·ª±</span>
            <span class="hidden md:inline">‚Ä¢</span>
            <span class="hidden md:inline">T·ª± ƒë·ªông ch√®n t√™n, l·ªõp, ng√†y‚Ä¶</span>
          </div>
        </div>
        <textarea id="output" class="paper w-full h-[560px] mt-3 font-[Inter] leading-7 border rounded-lg p-4 resize-vertical nice-focus" placeholder="(N·ªôi dung s·∫Ω hi·ªán ·ªü ƒë√¢y)"></textarea>
      </div>
      <footer class="text-center text-xs text-slate-500 mt-2">¬© 2025 ‚Äì B·∫£n lung linh. M·ªçi chi ti·∫øt c√≥ th·ªÉ ch·ªânh trong ph·∫ßn m√£.</footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    // Elements
    const groupEl = $("group");
    const levelEl = $("level");
    const viotypeEl = $("viotype");
    const viotypeCustomEl = $("viotypeCustom");
    const audienceEl = $("audience");
    const toneEl = $("tone");
    const studentEl = $("student");
    const classEl = $("class");
    const dateEl = $("date");
    const groupnameEl = $("groupname");
    const achievementEl = $("achievement");
    const teacherEl = $("teacher");
    const useEmojiEl = $("useEmoji");
    const addHeaderEl = $("addHeader");
    const outputEl = $("output");
    const progressEl = $("progress");
    const charCountEl = $("charCount");
    const violationControls = $("violationControls");

    function ripple(e){
      const btn = e.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(btn.clientWidth, btn.clientHeight);
      const radius = diameter / 2;
      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${e.clientX - btn.getBoundingClientRect().left - radius}px`;
      circle.style.top = `${e.clientY - btn.getBoundingClientRect().top - radius}px`;
      circle.classList.add("ripple");
      const ripple = btn.getElementsByClassName("ripple")[0];
      if (ripple) ripple.remove();
      btn.appendChild(circle);
    }
    document.querySelectorAll(".btn").forEach(b => b.addEventListener("click", ripple));

    // Toggle custom viotype
    viotypeEl.addEventListener("change", () => {
      viotypeCustomEl.classList.toggle("hidden", viotypeEl.value !== "kh√°c");
    });
    // Toggle violation block
    groupEl.addEventListener("change", () => {
      violationControls.classList.toggle("hidden", groupEl.value !== "violation");
    });

    // Templates
    const templates = {
      violation: {
        hs: {
          1: (ctx) => `${ctx.emoji} Th·∫ßy ghi nh·∫≠n ${ctx.studentTxt} chƒÉm ch·ªâ, nh∆∞ng h√¥m nay em ${ctx.viotypeTxt}. ƒêi ƒë√∫ng gi·ªù v√† ch·∫•p h√†nh n·ªôi quy gi√∫p em h·ªçc t·ªët v√† t√¥n tr·ªçng th·∫ßy c√¥, b·∫°n b√®. Th·∫ßy tin l·∫ßn sau em s·∫Ω ch·ªß ƒë·ªông h∆°n nh√©!`,
          2: (ctx) => `${ctx.emoji} Em ƒë√£ ${ctx.viotypeTxt} l·∫ßn th·ª© 2 (ng√†y ${ctx.dateTxt}). Th·∫ßy mong em nh√¨n l·∫°i nguy√™n nh√¢n, s·∫Øp x·∫øp th·ªùi gian h·ª£p l√Ω. Ch·∫•p h√†nh n·ªôi quy th·ªÉ hi·ªán tr√°ch nhi·ªám v√† gi√∫p em t·ª± tin h∆°n. Th·∫ßy tin em s·∫Ω thay ƒë·ªïi t√≠ch c·ª±c!`,
          3: (ctx) => `${ctx.emoji} ƒê√¢y l√† l·∫ßn th·ª© 3 em ${ctx.viotypeTxt}. Th·∫ßy mong em nghi√™m t√∫c ƒëi·ªÅu ch·ªânh ngay ‚Äì ƒë√¢y l√† k·ª∑ lu·∫≠t v√† tr√°ch nhi·ªám c·ªßa m·ªôt h·ªçc sinh. Th·∫ßy tin em c√≥ b·∫£n lƒ©nh ƒë·ªÉ thay ƒë·ªïi v√† ch·ª©ng minh s·ª± tr∆∞·ªüng th√†nh.`
        },
        ph: {
          1: (ctx) => `K√≠nh g·ª≠i qu√Ω ph·ª• huynh, h√¥m nay em ${ctx.studentTxt} (${ctx.classTxt}) ${ctx.viotypeTxt}. ƒê√¢y l√† l·∫ßn ƒë·∫ßu, th·∫ßy nh·∫Øc nh·∫π ƒë·ªÉ em r√∫t kinh nghi·ªám. Mong gia ƒë√¨nh ƒë·ªông vi√™n em gi·ªØ n·ªÅ n·∫øp ·∫°.`,
          2: (ctx) => `K√≠nh g·ª≠i qu√Ω ph·ª• huynh, ƒë√¢y l√† l·∫ßn th·ª© 2 em ${ctx.studentTxt} (${ctx.classTxt}) ${ctx.viotypeTxt} (ng√†y ${ctx.dateTxt}). Mong gia ƒë√¨nh ph·ªëi h·ª£p nh·∫Øc nh·ªü th√™m ƒë·ªÉ em h√¨nh th√†nh th√≥i quen t·ªët.`,
          3: (ctx) => `K√≠nh ch√†o qu√Ω ph·ª• huynh, em ${ctx.studentTxt} (${ctx.classTxt}) ƒë√£ ${ctx.viotypeTxt} l·∫ßn th·ª© 3. ƒê·ªÅ ngh·ªã gia ƒë√¨nh ph·ªëi h·ª£p ch·∫∑t ch·∫Ω ƒë·ªÉ em ƒëi·ªÅu ch·ªânh k·ªãp th·ªùi, tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác h·ªçc v√† n·ªÅ n·∫øp l·ªõp.`
        }
      },
      encourage: {
        all: (ctx) => `${ctx.emoji} H√¥m nay th·∫ßy r·∫•t vui v√¨ l·ªõp ${ctx.classTxt} h·ªçc t·∫≠p nghi√™m t√∫c v√† ƒëo√†n k·∫øt. Mong c√°c em gi·ªØ tinh th·∫ßn n√†y cho c·∫£ tu·∫ßn nh√©!`
      },
      praise: {
        group: (ctx) => `${ctx.emoji} Ch√∫c m·ª´ng ${ctx.groupnameTxt} ƒë√£ l√†m vi·ªác t√≠ch c·ª±c trong ti·∫øt h·ªçc h√¥m nay. ƒê√¢y l√† t·∫•m g∆∞∆°ng ƒë·ªÉ c·∫£ l·ªõp noi theo!`,
        person: (ctx) => `${ctx.emoji} B·∫°n ${ctx.studentTxt} ƒë√£ ti·∫øn b·ªô r√µ r·ªát trong ${ctx.achievementTxt}. Mong c√°c b·∫°n kh√°c h·ªçc t·∫≠p tinh th·∫ßn ch·ªß ƒë·ªông n√†y.`
      },
      softremind: {
        hw: (ctx) => `${ctx.emoji} M·ªôt s·ªë b·∫°n ch∆∞a ho√†n th√†nh b√†i t·∫≠p. C√°c em s·∫Øp x·∫øp l·∫°i th·ªùi gian ƒë·ªÉ theo k·ªãp b√†i nh√©. Th·∫ßy tin c√°c em l√†m ƒë∆∞·ª£c.`,
        gear: (ctx) => `${ctx.emoji} M·ªôt s·ªë b·∫°n qu√™n mang s√°ch v·ªü, l·∫ßn sau nh·ªõ chu·∫©n b·ªã ƒë·∫ßy ƒë·ªß nh√©. Th√≥i quen nh·ªè gi√∫p em h·ªçc t·ªët h∆°n.`
      },
      inspire: {
        a: (ctx) => `${ctx.emoji} ƒêi h·ªçc kh√¥ng ch·ªâ ƒë·ªÉ l·∫•y ƒëi·ªÉm, m√† l√† h√†nh tr√¨nh r√®n luy·ªán s·ª± ki√™n nh·∫´n v√† tr√°ch nhi·ªám. H√£y c·ªë g·∫Øng t·ª´ng ng√†y, th·∫ßy lu√¥n ƒë·ªìng h√†nh c√πng c√°c em.`,
        b: (ctx) => `${ctx.emoji} M·ªói kh√≥ khƒÉn l√† m·ªôt c∆° h·ªôi ƒë·ªÉ tr∆∞·ªüng th√†nh. Th·∫ßy tin l·ªõp m√¨nh ƒë·ªß b·∫£n lƒ©nh ƒë·ªÉ v∆∞·ª£t qua m·ªçi th·ª≠ th√°ch.`
      },
      parents: {
        a: (ctx) => `K√≠nh g·ª≠i qu√Ω ph·ª• huynh, trong tu·∫ßn qua l·ªõp ${ctx.classTxt} ƒë√£ c√≥ nhi·ªÅu ti·∫øn b·ªô v·ªÅ n·ªÅ n·∫øp h·ªçc t·∫≠p. Ch√¢n th√†nh c·∫£m ∆°n gia ƒë√¨nh ƒë√£ lu√¥n ƒë·ªìng h√†nh.`,
        b: (ctx) => `Nh√† tr∆∞·ªùng v√† gia ƒë√¨nh l√† hai c√°nh tay gi√∫p c√°c em ph√°t tri·ªÉn to√†n di·ªán. Mong qu√Ω ph·ª• huynh ti·∫øp t·ª•c ph·ªëi h·ª£p ch·∫∑t ch·∫Ω ƒë·ªÉ nh·∫Øc nh·ªü con em gi·ªØ n·ªÅ n·∫øp v√† tinh th·∫ßn h·ªçc t·∫≠p.`
      }
    };

    function buildContext() {
      const emojiMap = {
        "m·∫∑c ƒë·ªãnh": "‚úÖ",
        "·∫•m √°p": "üíõ",
        "nghi√™m t√∫c": "‚ö†Ô∏è",
        "truy·ªÅn c·∫£m h·ª©ng": "üöÄ"
      };
      const emoji = $("useEmoji").checked ? (emojiMap[$("tone").value] || "‚úÖ") : "";
      const studentTxt = studentEl.value || "em ‚Ä¶";
      const classTxt = classEl.value || "l·ªõp ‚Ä¶";
      const dateTxt = dateEl.value || "‚Ä¶/‚Ä¶/‚Ä¶";
      let viotype = viotypeEl.value === "kh√°c" ? (viotypeCustomEl.value || "vi ph·∫°m n·ªôi quy") : viotypeEl.value;
      const groupnameTxt = groupnameEl.value || "nh√≥m ‚Ä¶";
      const achievementTxt = achievementEl.value || "‚Ä¶";
      const teacherTxt = teacherEl.value || "Th·∫ßy V≈© Ti·∫øn L·ª±c 0969068849";
      return { emoji, studentTxt, classTxt, dateTxt, viotypeTxt: viotype, groupnameTxt, achievementTxt, teacherTxt };
    }

    function generate() {
      const ctx = buildContext();
      const group = groupEl.value;
      const audience = audienceEl.value;
      let text = "";

      if (group === "violation") {
        const lv = levelEl.value;
        text = templates.violation[audience][lv](ctx);
      } else if (group === "encourage") {
        text = templates.encourage.all(ctx);
      } else if (group === "praise") {
        text = (groupnameEl.value ? templates.praise.group(ctx) : templates.praise.person(ctx));
      } else if (group === "softremind") {
        text = (achievementEl.value ? templates.softremind.hw(ctx) : templates.softremind.gear(ctx));
      } else if (group === "inspire") {
        text = (toneEl.value === "truy·ªÅn c·∫£m h·ª©ng" ? templates.inspire.b(ctx) : templates.inspire.a(ctx));
      } else if (group === "parents") {
        text = (achievementEl.value ? templates.parents.b(ctx) : templates.parents.a(ctx));
      }

      if (addHeaderEl.checked) {
        if (audience === "ph") text = `K√≠nh g·ª≠i qu√Ω ph·ª• huynh,\n${text.replace(/^K√≠nh.*?ph·ª• huynh,?\s*/i, "")}`;
        else text = `Ch√†o em,\n${text}`;
      }
      if (ctx.teacherTxt && ctx.teacherTxt.trim() !== "") text += `\n\n${ctx.teacherTxt}`;

      outputEl.value = text;
      updateStats();
    }

    function updateStats(){
      const len = outputEl.value.length;
      charCountEl.textContent = `${len} k√≠ t·ª±`;
      const fill = Math.min(1, len / 400);
      progressEl.style.transform = `scaleX(${fill})`;
    }

    function copyToClipboard() {
      outputEl.select();
      document.execCommand("copy");
      const btn = document.getElementById("btnCopy");
      const old = btn.textContent;
      btn.textContent = "ƒê√£ copy ‚úÖ";
      setTimeout(() => (btn.textContent = old), 1200);
    }

    function downloadTxt() {
      const blob = new Blob([outputEl.value || ""], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "tin-nhan-chu-nhiem.txt";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    function resetAll() {
      groupEl.value = "violation";
      levelEl.value = "1";
      viotypeEl.value = "ƒëi h·ªçc tr·ªÖ";
      viotypeCustomEl.value = "";
      viotypeCustomEl.classList.add("hidden");
      audienceEl.value = "hs";
      toneEl.value = "m·∫∑c ƒë·ªãnh";
      studentEl.value = "";
      classEl.value = "";
      dateEl.value = "";
      groupnameEl.value = "";
      achievementEl.value = "";
      teacherEl.value = "Th·∫ßy L·ª±c";
      $("useEmoji").checked = true;
      $("addHeader").checked = false;
      outputEl.value = "";
      violationControls.classList.remove("hidden");
      updateStats();
    }

    // Presets
    document.querySelectorAll("[data-preset]").forEach(btn => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-preset");
        resetAll();
        if (key === "late2hs") {
          groupEl.value = "violation"; levelEl.value = "2"; audienceEl.value = "hs"; viotypeEl.value = "ƒëi h·ªçc tr·ªÖ";
          studentEl.value = "Th√πy Tr√¢m"; classEl.value = "10A8";
        } else if (key === "late3ph") {
          groupEl.value = "violation"; levelEl.value = "3"; audienceEl.value = "ph"; viotypeEl.value = "ƒëi h·ªçc tr·ªÖ";
          studentEl.value = "‚Ä¶"; classEl.value = "10A8";
        } else if (key === "praise") {
          groupEl.value = "praise"; groupnameEl.value = "Nh√≥m 2"; achievementEl.value = "thuy·∫øt tr√¨nh xu·∫•t s·∫Øc";
        } else if (key === "enc") {
          groupEl.value = "encourage"; classEl.value = "10A8";
        }
        generate();
      });
    });

    $("btnGenerate").addEventListener("click", generate);
    $("btnCopy").addEventListener("click", copyToClipboard);
    $("btnDownload").addEventListener("click", downloadTxt);
    $("btnReset").addEventListener("click", resetAll);
    outputEl.addEventListener("input", updateStats);

    // Init
    resetAll();
  </script>
</body>
</html>
